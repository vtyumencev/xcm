(function(){"use strict";let x=()=>({emit(e,...t){for(let s=0,o=this.events[e]||[],n=o.length;s<n;s++)o[s](...t)},events:{},on(e,t){var s;return((s=this.events)[e]||(s[e]=[])).push(t),()=>{var o;this.events[e]=(o=this.events[e])==null?void 0:o.filter(n=>t!==n)}}});var S=Object.defineProperty,v=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,y=(e,t,s)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,c=(e,t)=>{for(var s in t||(t={}))k.call(t,s)&&y(e,s,t[s]);if(v)for(var s of v(t))M.call(t,s)&&y(e,s,t[s]);return e},T=(e,t,s)=>new Promise((o,n)=>{var a=r=>{try{g(s.next(r))}catch(p){n(p)}},i=r=>{try{g(s.throw(r))}catch(p){n(p)}},g=r=>r.done?o(r.value):Promise.resolve(r.value).then(a,i);g((s=s.apply(e,t)).next())}),A=class{constructor(){this.isInitialized=!1,this.BASE_Z_INDEX=100,this.TAB_QUERY_SELECTORS='a[href]:not([disabled]),button:not([disabled]),textarea:not([disabled]),input[type="submit"]:not([disabled]),input[type="text"]:not([disabled]),input[type="radio"]:not([disabled]),input[type="checkbox"]:not([disabled]),select:not([disabled])',this.modalsEnabled=!1,this.hookOptionsList=[],this.connectedModules=[],this.modals=[],this.emitter=x(),document.addEventListener("DOMContentLoaded",this.updateScrollbarBuffer),window.addEventListener("resize",this.updateScrollbarBuffer)}on(e,t){return this.emitter.on(e,t)}updateScrollbarBuffer(){console.log(1);const e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",document.body.appendChild(e);const t=document.createElement("div");e.appendChild(t);const s=e.offsetWidth-t.offsetWidth;e.parentNode.removeChild(e),document.body.style.setProperty("--scroll-bar-buffer",s+"px")}openModal(e){return T(this,arguments,function*(t,s={}){for(const i of this.modals)if(i.el===t)return;let n=c({},{closable:!0,onOpening:null,onOpen:null,onClosing:null,onClose:null,transitionDuration:300});for(const i of this.hookOptionsList)i.modalId===t.getAttribute("id")&&(n=c(c({},n),i.options));if(n=c(c({},n),s),t.style.zIndex=(this.BASE_Z_INDEX+this.modals.length).toString(),t.setAttribute("tabindex","-1"),t.classList.add("showing"),t.classList.add("shown"),n.onOpening){let i=!1;setTimeout(()=>{i||t.classList.add("loading")},20),yield n.onOpening(t).catch(()=>{throw t.classList.remove("loading"),t.classList.remove("shown"),t.classList.remove("showing"),new Error("Impossible to create a modal window with an opening callback: "+n.onOpening)}),i=!0,t.classList.remove("loading")}t.querySelector(".sx-modal-dialog").clientHeight>window.innerHeight?t.classList.add("scrollable"):t.classList.remove("scrollable"),t.offsetWidth,t.classList.add("visible"),setTimeout(()=>{var i;t.classList.add("released"),t.classList.remove("showing"),(i=t.querySelectorAll(this.TAB_QUERY_SELECTORS)[0])==null||i.focus()},n.transitionDuration+100);const a=[];t.querySelectorAll(".js-action-close").forEach(i=>{a.push({el:i,name:"click",callback:this.destroyModalClickEvent.bind(this)})}),a.push({el:t,name:"click",callback:this.onDocumentClick.bind(this)}),a.push({el:t,name:"keydown",callback:this.onKeyEvent.bind(this)});for(const i of a)i.el.addEventListener(i.name,i.callback);this.modals.push({previousActiveElement:document.activeElement,el:t,options:n,events:a}),this.updateModals()})}destroyModal(e){const t={modal:e,callback:()=>{const s=e.el;s.classList.add("hiding"),s.classList.remove("visible"),s.classList.remove("released"),setTimeout(()=>{var o;s.classList.remove("shown"),s.classList.remove("hiding"),(o=e.previousActiveElement)==null||o.focus(),this.updateModals()},e.options.transitionDuration);for(const o of e.events)o.el.removeEventListener(o.name,o.callback);e.options.onClose&&e.options.onClose(s),this.modals=this.modals.filter(o=>s!==o.el)}};this.emitter.emit("dialogDestroying",t),t.callback()}onDocumentClick(e){e.target.closest(".js-sx-modal-dialog-body")||this.modals[this.modals.length-1].options.closable===!0&&this.destroyModal(this.modals[this.modals.length-1])}onKeyEvent(e){if(e.key==="Escape"&&this.modals[this.modals.length-1].options.closable===!0){this.destroyModal(this.modals[this.modals.length-1]);return}const t=this.modals[this.modals.length-1].el.querySelectorAll(this.TAB_QUERY_SELECTORS),s=t[0],o=t[t.length-1];e.key==="Tab"&&(this.modals[this.modals.length-1].el.contains(document.activeElement)?e.shiftKey?document.activeElement===s&&(o.focus(),e.preventDefault()):document.activeElement===o&&(s.focus(),e.preventDefault()):(s&&s.focus(),e.preventDefault()))}destroyModalClickEvent(e){const t=e.target.closest(".sx-modal"),s=this.modals.find(o=>t===o.el);s&&this.destroyModal(s)}updateModals(){if(this.modals.length>0){if(this.modalsEnabled)return;this.modalsEnabled=!0,document.body.classList.add("has-active-sx-modal")}else{if(!this.modalsEnabled)return;this.modalsEnabled=!1,document.body.classList.remove("has-active-sx-modal")}}start(e){if(this.isInitialized)return console.warn("SXModal: Already initialized"),this;this.keyDownEvent=this.onKeyEvent.bind(this);for(const t of e??[]){const s=new t(this);s.modalInit(),this.connectedModules.push(s)}this.isInitialized=!0}addOptionsHook(e,t){this.hookOptionsList.push({modalId:e,options:t})}init(e,t={}){let s;e instanceof HTMLElement?s=e:typeof e=="string"&&(s=document.querySelector(e)),s&&this.openModal(s,t)}destroy(e){let t;if(e instanceof HTMLElement?t=e:typeof e=="string"&&(t=document.querySelector(e)),!!t)for(const s of this.modals)s.el===t&&this.destroyModal(s)}},u=new A;const f="js-xcm-manager-category-review";let l,h,d;const O=e=>{const t=d.getUserConfig();for(const s of Object.entries(t.contest))if(e.contest[s[0]]===!0&&s[1]===!1)return!0;return!1},b=e=>{e.target.closest(`.${f}`).classList.contains("active")?e.target.closest(`.${f}`).classList.remove("active"):e.target.closest(`.${f}`).classList.add("active")},w=e=>{const t=e.target.getAttribute("data-vendor-id"),s=_("xcm-modal-vendor");document.body.appendChild(s),u.init(s,{onOpening:async()=>{await fetch(window.XCMSettingsPublic.ajaxUrl+"?action=xcm_vendor&vendorId="+t,{}).then(o=>o.text()).then(o=>{s.querySelector(".sx-modal-dialog__content").innerHTML=o})},onClose:()=>{setTimeout(()=>{s.remove()},500)}})},L=async e=>{e.preventDefault(),e.submitter.getAttribute("data-action")==="accept-all"&&e.target.querySelectorAll(".xcm-manager-category-switch input").forEach(s=>{s.checked=!0}),setTimeout(()=>{u.destroy(l)},100);const t=d.getUserConfig();await fetch(window.XCMSettingsPublic.ajaxUrl+"?action=xcm_update",{method:"POST",body:new FormData(e.target)}).then(s=>s.json()),O(t)&&window.location.reload(),d.emit("contestUpdated")},P=(e,t=null)=>{if(e.querySelectorAll(".js-xcm-manager-category-toggle").forEach(s=>{s.addEventListener("click",b)}),e.querySelectorAll(".js-xcm-vendor-review").forEach(s=>{s.addEventListener("click",w)}),t){const s=e.querySelector(`.xcm-manager-category[data-id="${t}"]`);s&&setTimeout(()=>{s.classList.add("active"),s.scrollIntoView({behavior:"smooth"})},500)}e.querySelector(".js-xcm-manager-form").addEventListener("submit",L)},U=e=>{e.querySelectorAll(".js-xcm-manager-category-toggle").forEach(t=>{t.removeEventListener("click",b)}),e.querySelectorAll(".js-xcm-vendor-review").forEach(t=>{t.removeEventListener("click",w)}),e.querySelector(".js-xcm-manager-form").removeEventListener("submit",L)},_=e=>{const t=document.createElement("div");return t.classList.add("sx-modal"),t.setAttribute("id",e),t.innerHTML=`
            <div class="sx-modal__inner">
                <div class="sx-modal-dialog__bg"></div>
                <div class="sx-modal-dialog modal-dialog--lg">
                    <div class="sx-modal-dialog__container">
                        <div class="sx-modal-dialog__body">
                            <div class="sx-modal-dialog__content"></div>
                        </div>
                    </div>
                </div>
                <div class="sx-modal-loading">
                    <div class="sx-modal-loading__body">
                        Wird geladen...
                    </div>
                </div>
            </div>`,document.body.appendChild(t),t},j=(()=>{const e=async()=>await fetch(window.XCMSettingsPublic.ajaxUrl+"?action=xcm_overview",{}).then(t=>t.text()).then(t=>t);return{show(t=!0,s=null){let o=new Promise(n=>n(!0));l||(l=_("xenio-contest-modal"),h=l.querySelector(".sx-modal-dialog__content"),document.body.appendChild(l),o=new Promise(async n=>{h.innerHTML=await e(),n(!0)})),u.init(l,{onOpening:async()=>{await o,P(h,s)},onClose:()=>{U(h)},closable:t})},start(t){d=t,window.addEventListener("popstate",()=>{if(window.location.hash.startsWith("#contest-overview")){const s=window.location.hash.match(/#contest-overview\.cat\.(\d*)/),o=s&&(parseInt(s[1])??null);this.show(!0,o)}}),window.addEventListener("DOMContentLoaded",()=>{d.getUserConfig()||this.show(!1)},{once:!0})}}})(),D=(()=>{let e;const t=window.dataLayer=window.dataLayer||[];function s(...n){t.push(arguments)}const o={ad_storage:"denied",ad_user_data:"denied",ad_personalization:"denied",analytics_storage:"denied"};return{start(n){e=n,s("consent","default",Object.assign(o,e.getContestContestsTypes())),e.getUserConfig()&&s("event","update_contest"),e.on("contestUpdated",()=>{this.update()})},update(){s("consent","update",Object.assign(o,e.getContestContestsTypes())),s("event","update_contest")}}})(),C=(()=>({emit(e,...t){for(let s=this.events[e]||[],o=0,n=s.length;o<n;o++)s[o](...t)},events:{},on(e,t){var s;return((s=this.events)[e]||(s[e]=[])).push(t),()=>{var o;this.events[e]=(o=this.events[e])==null?void 0:o.filter(n=>t!==n)}}}))(),I=e=>{let t=e+"=",s=document.cookie.split(";");for(let o=0;o<s.length;o++){let n=s[o];for(;n.charAt(0)===" ";)n=n.substring(1);if(n.indexOf(t)===0)return n.substring(t.length,n.length)}return""},m=(()=>{const e=window.XCMSettingsPublic;return{on(t,s){return C.on(t,s)},emit(t,...s){return C.emit(t,...s)},getUserConfig(){let t;try{const s=I("xcm");t=JSON.parse(decodeURIComponent(s))}catch{}return t},getContestContestsTypes(){var o;const t=this.getUserConfig(),s={};if(!(t!=null&&t.contest))return s;for(const n of e.categories){if(!t.contest[n.id])continue;const a=((o=n.contest_types)==null?void 0:o.split(","))??[];for(const i of a)s[i]="granted"}return s},isProviderBlocked(t){const s=this.getUserConfig();for(const o of e.categories)if(!(s!=null&&s.contest[o.id])){for(const n of o.vendors)if(o.necessary==="0"&&n.provider&&t.includes(n.provider))return{provider:n.provider,category_id:o.id,category_name:o.name}}return!1}}})(),F="",K="",q=()=>{let e;const t=()=>{document.querySelectorAll(".xcm-embed-replacer").forEach(s=>{if(!e.isProviderBlocked(s.getAttribute("data-provider"))){const o=B(s.getAttribute("data-origin"));E(o),s.after(o),s.remove()}})};return{start(s){e=s,document.addEventListener("DOMContentLoaded",()=>{t()}),e.on("contestUpdated",()=>{t()})}}};function B(e,t=!0){if(e=t?e.trim():e,!e)return null;const s=document.createElement("template");return s.innerHTML=e,s.content.children[0]}function E(e){if(H(e)===!0)e.parentNode.replaceChild(R(e),e);else{let t=-1,s=e.childNodes;for(;++t<s.length;)E(s[t])}return e}function R(e){const t=document.createElement("script");t.text=e.innerHTML;let s=-1,o=e.attributes,n;for(;++s<o.length;)t.setAttribute((n=o[s]).name,n.value);return t}function H(e){return e.tagName==="SCRIPT"}const N=q();u.start(),D.start(m),j.start(m),N.start(m)})();
